@page "/signup"
@using WeDancin.Domain.Entities.Accounts
@inject ILocalStorageService _localStorage
@inject NavigationManager _navigationManager
@inject IUserRepository _userRepository
<style>
    /* || PAGE LAYOUT STYLES */
    .espaco-cadastro {
        display: flex;
        flex-direction: column;
        flex-wrap: nowrap;
        justify-content: center;
        align-items: center;
        position: relative;
        height: 557px;
        width: 461px;
        margin: auto;
        z-index: 3;
    }

    .form-floating {
        margin: 20px auto;
    }
</style>


@if (!userCreated)
{

<header>
    <img src="/images/Lines/sign-up.svg" alt="Linhas orgânicas coloridas" style="position: absolute; left: 0; top: -2px; z-index: 1;" />
    <div style="display: block; text-align: center; position: relative; z-index: 3;"><img src="/images/Brand/Logo.svg" alt="Logo We Dancin" style="margin-top: 35px; margin-bottom: 77px;" /></div>
</header>

                <div class="espaco-cadastro">
                    <h3 style="margin: 16px 0; text-align: center;">Criar conta</h3>

                    @*<div>
                            <button style="background: rgba(24, 119, 242, 1); border: 2px solid rgba(81, 0, 91, 0.65); border-radius: 10px; border-color: #1877F2; color: white; font: normal bold 18px Lato; width: 461px; height: 62px; margin-bottom: 20px;">Continue with Facebook</button>
                            <button style="background: rgba(255, 255, 255, 0.3); border: 2px solid rgba(81, 0, 91, 0.65); border-radius: 10px; border-color: #FFFFFF; color: #51005B; font: normal bold 18px Lato; width: 461px; height: 62px; box-shadow: 0px 0px 3px rgba(0, 0, 0, 0.084), 0px 2px 3px rgba(0, 0, 0, 0.168);">Continue with Google</button>
                        </div>

                        <div style="margin: 26px 5px 0 5px;">
                            <p class="purple-body-text" style="margin-bottom: 6px; text-align: center;">ou</p>
                        </div>*@

                    <div style="display: flex; flex-direction: column;">

                        @if (erro)
                        {
        <div class="alert alert-danger" role="alert">
            @message
        </div>}


                        <EditForm class="form-signin" Model="@user" OnValidSubmit="@HandleValidSubmit">
                            <div class="form-floating">
                                <input type="text" class="form-control on-surface active-placeholder" @bind="user.Username" id="floatingText" placeholder="Nome de usuário" required>
                                <label for="floatingText">Nome de usuário</label>
                            </div>
                            <div class="form-floating">
                                <input type="email" class="form-control on-surface active-placeholder" @bind="user.Email" id="floatingInput" placeholder="name@example.com" required>
                                <label for="floatingInput">E-mail</label>
                            </div>
                            <div class="form-floating" style="margin-top: 40px;">
                                <input type="password" class="form-control on-surface active-placeholder" @bind="user.PasswordHash" id="floatingPassword" placeholder="Crie sua senha" required>
                                <label for="floatingPassword">Crie sua senha</label>
                                <p class="under-text" style="margin-left: 8px;">A senha deve ter 8 caracteres ou mais.</p>
                            </div>
                            <div class="form-floating">
                                <input type="password" class="form-control on-surface active-placeholder" @bind="passwordConfirm" id="floatingPasswordConfirm" placeholder="Confirme sua senha" required>
                                <label for="floatingPasswordConfirm">Confirme sua senha</label>
                            </div>
                            <div style="display: flex; flex-direction: column; align-items: center;"><button class="dark-purple-button long-button" style="width: 461px;">Cadastrar</button></div>
                            <div style="margin: 16px 5px;">
                                <p class="body-text" style="letter-spacing: -0.02em; text-align: center;">Ao continuar, você concorda com os <a href="#" style="color: #1877F2;">Termos de Serviço da WeDancin</a> e <a href="#" style="color: #1877F2;">Políticas de Privacidade</a>.</p>
                            </div>
                        </EditForm>
                        <div style="margin-top: 14px;">
                            <p class="body-text" style="text-align: center; font-weight: 700 !important;">Já tem cadastro? <a href="login" style="color: #1877F2;">Acesse sua conta.</a></p>
                        </div>
                    </div>
                </div> }
            else
            {
<header>
    <img src="/images/Brand/Logo.svg" alt="We Dancin logo"
         style="position: absolute; width: 107px; left: 10.5%; top: 32px;" />
</header> @*                 Conteúdo do Box                  *@

                <section class="espaco-validacao">
                    <div style="text-align: center;">
                        <h1>Verifique sua caixa de entrada!</h1>
                        <div>
                            <p class="body-text" style="margin-bottom: .2rem;">Enviamos um e-mail para @user.Email.</p>
                            <p class="body-text">Clique no link do e-mail para confirmá-lo e ativar sua conta.</p>
                        </div>
                    </div>
                    <div style="text-align: center; margin-top: 20px;">
                        <h4>Não recebeu nosso e-mail?</h4>
                        <div><p class="body-text">Verifique sua pasta de spam ou <a href="#" style="color: #1877F2;">clique aqui</a>.</p></div>
                    </div>
                </section> @*                 Responsívo (mudar a imagem)                  *@
                                <footer>
                                    <img src="/images/Lines/validated.svg" alt="Linhas orgânicas" style="position: absolute; left: 0; top: 280px;" />
                                </footer>}



@code{ private User user = new User();
    private bool erro = false;
    private string message = string.Empty;

    private string passwordConfirm = string.Empty;

    private bool userCreated = false;

    private async Task HandleValidSubmit()
    {
        try
        {

            if (user.PasswordHash != passwordConfirm)
            {
                erro = true;
                message = "As senhas não conferem.";
            }
            else
            {
                user.UserTypeId = 1;
                var apiResponse = await _userRepository.CreateAsync(user);

                if (apiResponse.result != null)
                {
                    var user = _userRepository.UserRepositoryUserMiddleware(apiResponse.result);

                    if (user != null)
                    {
                        userCreated = true;
                    }
                }
                else
                {
                    erro = true;
                    message = apiResponse.Message;
                }
            }


        }
        catch (Exception ex)
        {
            throw;
        }

    } }